// Firestore Security Rules（Todo用：本人のみ読み書き可）
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // todos コレクション
    match /todos/{id} {

      // 取得・一覧（クエリ含む）
      allow read: if isOwner(resource.data.ownerId);

      // 作成・更新・削除
      allow write: if isOwner(request.resource.data.ownerId)
                   && validTodo(request.resource.data);
    }
  }

  function isOwner(ownerId) {
    return request.auth != null && ownerId == request.auth.uid;
  }

  // 最低限の入力バリデーション（任意強化可）
  function validTodo(data) {
    return data.keys().hasOnly(['title','done','createdAt','ownerId']) &&
           data.title is string && data.title.size() > 0 && data.title.size() <= 200 &&
           data.done is bool &&
           data.createdAt is int &&
           data.ownerId is string;
  }
}

